## Redis 분산 락에서 Failover 문제 및 해결 방법
**문제 상황**
* Redis 분산 락 시스템에서 App1이 특정 리소스의 락을 취득한 상태에서 다음과 같은 상황이 발생 
  * Redis의 마스터 노드가 장애로 인해 다운 
  * Redis Replica 노드가 Failover를 통해 새로운 마스터로 승격 
* 이 과정에서, 기존 마스터의 락 정보가 Replica로 완전히 동기화되지 못할 경우 
  * 락을 가진 상태에서 failover가 발생했으므로, 실제로 락이 유효하지 않을 수 있음 
  * 결과적으로 다른 애플리케이션들이 동일한 락을 중복으로 취득 
  * 데이터 무결성 문제나 동시성 오류 발생 가능

**문제 해결 및 방지 방안**
1. Redlock (분산 락 아키텍처)
   * Redlock은 여러 Redis 노드에서 락을 분산 관리하여 신뢰성을 높이는 알고리즘 
   * 락을 취득할 때, 단일 Redis 인스턴스가 아니라 과반수 이상의 노드에서 락을 취득해야 락이 유효하다고 간주 
     * 5개의 Redis 노드 중 3개 이상에서 락 취득 시 성공
   * 한 노드에서 장애가 발생해도 나머지 노드가 정상적으로 운영 가능
   * 락 정보 동기화 문제가 줄어듦 
   * Redlock에서도 락 취득 및 동기화 타이밍 이슈가 생길 수 있음
2. 동기식 복제
   * Redis는 기본적으로 비동기 복제를 사용. 따라서 장애 발생 시, 일부 데이터(특히 락 정보)가 Replica로 동기화되지 않을 수 있음
   * 락을 취득 → 모든 Replica에 락 정보 복제 완료 확인 → 이후 작업 수행 
   * 성능 저하(속도 감소)가 있지만, 데이터 무결성 보장이 더 중요할 때 적합
3. 클라이언트 측 복구 
   * 클라이언트가 락을 취득하고 작업을 수행할 때, 중간에 Failover가 발생했을 경우, 작업을 시작하기 전에 다시 한 번 락 유효성을 확인 
     * 작업 시작 전에 락이 여전히 존재하는지 확인 
     * 락의 만료시간(TTL)을 주기적으로 연장(heartbeat)하여 락 유지 
     * Failover 이후 락이 유효하지 않으면 재시도 또는 종료
