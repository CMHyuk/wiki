## 전송 계층

**전송 계층 개요**

- 네트워크 계층과 응용 계층 사이의 전송 계층
    - IP 한계 보완: 신뢰할 수 있는 통신과 연결형 통신 기능 제공
    - 응용 계층의 프로세스 식별: 포트 번호 활용

**IP 한계를 보완하는 전송 계층**

- 신뢰할 수 없는 통신과 비연결형 통신
- IP의 특징
    - 신뢰할 수 없는 (비신뢰성) 프로토콜
        - 패킷이 수신지까지 제대로 전송되었다는 보장을 하지 않음
        - 통신 과정에서 패킷이 잘못 전송되어도 이를 확인하지 않고, 재전송도 하지 않으며, 순서대로 패킷이 도착할 것이라는 보장도 하지 않는다는 의미
    - 비연결형 프로토콜
        - 송수신 호스트 간에 사전 연결 수립 작업을 거치지 않음
        - 그저 수신지를 향해 패킷을 보내기만 할 뿐
    - IP 패킷의 전달 = 신뢰성이 없는 통신 + 비연결형 통신

**IP는 왜 신뢰할 수 없는, 비연결형 통신을 할까?**

- 주된 이유는 성능으로, 신뢰할 수 있는 연결형 통신 = 성능에 악영향
- 신뢰성 있는 전송이 모든 경우에 필요한 것은 아님

**TCP**

- 연결형 통신을 가능하게 함
    - 송수신하는 동안에는 연결을 유지하고, 송수신이 끝나면 연결을 종료
- 신뢰성 있는 통신을 가능하게 함
    - 재전송을 통한 오류 제어, 흐름 제어, 혼잡 제어 등 다양한 기능들을 제공

**UDP**

- 신뢰할 수 없는 통신, 비연결형 통신을 가능하게 함
- TCP보다는 비교적 빠른 전송이 가능

**포트**

- 네트워크 상의 애플리케이션 식별 정보
- 패킷 내 수신지 포트와 송신지 포트를 통해 송수신지 호스트의 애플리케이션을 식별
- 16비트로 표현 가능 : 사용 가능한 포트의 수는 2의16승으로 65536개
    - 할당 가능한 포트 번호: 0번 ~ 65535번

**포트 번호 종류 및 범위**

| 포트 종류                     | 포트 번호 범위        | 설명                            |
|---------------------------|-----------------|-------------------------------|
| **Well-known ports**      | `0 ~ 1023`      | 운영체제나 표준 서비스에서 사용하는 포트        |
| **Registered ports**      | `1024 ~ 49151`  | 일반 애플리케이션에서 등록해서 사용하는 포트      |
| **Dynamic/Private ports** | `49152 ~ 65535` | 클라이언트에서 임시로 사용하는 포트 (에페머럴 포트) |

**예시**

| 포트 번호 | 서비스 예시          | 포트 종류             |
|-------|-----------------|-------------------|
| 22    | SSH             | Well-known        |
| 80    | HTTP            | Well-known        |
| 443   | HTTPS           | Well-known        |
| 3306  | MySQL           | Registered        |
| 8080  | Tomcat / WebApp | Registered        |
| 55000 | 클라이언트 임시 포트     | Dynamic / Private |

**포트를 활용하는 기술: 포트 기반 NAT**  
- NAT 변환 테이블: 변환의 대상이 되는 IP 주소 쌍 
- 사설 IP 주소 하나당 공인 IP 주소 하나가 대응: 많은 사설 IP 주소를 변환하기에는 무리가 있음 
- 공인 IP 주소의 낭비: 사설 IP 주소의 수만큼 공인 IP 주소가 필요

**NAPT(Network Address Port Translation), APT**  
- NAPT는 NAT 테이블에 변환할 IP 주소 쌍과 더불어 포트 번호도 함께 기록하고, 변환 
- 하나의 공인 IP 주소를 여러 사설 IP 주소가 공유 가능 
  - 사설 IP 주소: 공인 IP 주소를 N:1로 변환 
  - 공인 IP 주소 수 부족 문제를 개선한 기술